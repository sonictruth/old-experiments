function onYouTubeIframeAPIReady(){youtube_player=new YT.Player("player",{playerVars:{controls:0,autoplay:0,hd:1},events:{onError:onPlayerError,onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function play_video(a){console.log("play video",a),youtube_player&&youtube_player.loadVideoById(a,0)}function onPlayerError(a){a.data>=100&&setTimeout(function(){playNext()},1e3)}function playNext(){console.log("Play index: "+currentvideo);var a=videos[currentvideo];currentvideo++,currentvideo>=videos.length&&(currentvideo=0),document.location.hash=a,play_video(a)}function onPlayerReady(){loadVideos()}function onPlayerStateChange(a){var b=a.data;if(console.log("Status",b),1==b){var c=youtube_player.getVideoUrl(),d=youtube_player.getVideoData().title;window.document.title="dexTV > "+d,$("#artist").html('<a target="_blank" href="'+c+'">'+d+"</a>")}(0==b||5==b)&&playNext()}function showPlaylists(a){getPlaylists(a,listPlaylists)}function getPlaylists(a,b){jQuery.ajax("https://gdata.youtube.com/feeds/api/users/"+a+"/playlists?v=2",{dataType:"xml",error:function(){alert("Error!")},success:function(a){var c=jQuery(a).find("entry"),d=[];jQuery.each(c,function(){var a=jQuery(this).find("title").text().toLowerCase(),b=jQuery(this).find("content").attr("src");d.push({title:a,src:b})}),b(d)}})}function listPlaylists(a){0==a.length?alert("No public playlists!"):($.modal.close(),$c=$("#listplaylists .plcontent"),$c.html('<form id="pllist">'),$.each(a,function(a){var c='<input  type="checkbox" name="pl'+a+'" value="'+this.src+'">'+this.title+"<br/>";$c.append(c)}),$c.append("</form>"),$("#listplaylists").modal())}function shuffle(a,b){for(var d,e,c=a.length;--c;)d=0|(b?b():Math.random())*(c+1),e=a[c],a[c]=a[d],a[d]=e;return a}var youtube_player,currentvideo=0;$("#player").height($(window).height()),$(window).resize(function(){$("#player").height($(window).height())}),$(function(){var a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)});var loadVideos=function(){jQuery.ajax("videos.txt",{cache:!1,dataType:"text",error:function(){alert("Error 2")},success:function(a){window.videos=a.split(","),$("#status").html(videos.length+" videos loaded"),""!=document.location.hash?(window.videos=shuffle(window.videos),play_video(document.location.hash.substr(1))):$("#msg").modal()}})};$("#next").click(function(){playNext()});var getVideosFromPlaylists=function(a,b,c){console.log("getVideosFromPlaylists",a),c("Started loading...");var d=0,e=[],f=function(a,g){if(d>=a.length)return b(e),console.log("getVideosFromPlaylists done",a.length,d),void 0;url=a[d];var h=url+"&alt=json&start-index="+g+"&max-results=50";console.log("VideosFromPlaylist :",d,e.length+1),c("Playlist"+d+" "+e.length),jQuery.ajax(h,{dataType:"json",error:function(){alert("Error 2")},success:function(b){jQuery.each(b.feed.entry,function(){e.push(this.media$group.yt$videoid.$t)});var c=b.feed.openSearch$totalResults.$t,h=g+50;return h>c?(d++,f(a,1),void 0):(f(a,h),void 0)}})};f(a,1)};$("#listplaylists button").click(function(){var a=$("#listplaylists input:checkbox:checked").map(function(){return $(this).val()}).get();$.modal.close(),$("#loadingstatus").modal(),$ls=$("#loadingstatus div"),getVideosFromPlaylists(a,function(a){$.modal.close(),currentvideo=0,window.videos=shuffle(a),playNext(),$("#status").html(videos.length+" videos")},function(a){$ls.html(a)})}),$("#pall").click(function(){$.modal.close(),window.videos=shuffle(window.videos),playNext()}),$("#p50").click(function(){$.modal.close(),$("#status").html("Latest 50 videos"),window.videos=window.videos.slice(0,50),playNext()}),$("#p100").click(function(){$.modal.close(),$("#status").html("Latest 100 videos"),window.videos=window.videos.slice(0,100),playNext()}),$("#p200").click(function(){$.modal.close(),$("#status").html("Latest 200 videos"),window.videos=window.videos.slice(0,200),playNext()}),$("#pyou").click(function(){var a=prompt("Enter youtube username:","subpoprecords");showPlaylists(a)});
